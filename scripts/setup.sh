#!/bin/bash

# ุณูุฑูุจุช ุงูุฅุนุฏุงุฏ ุงูุฃููู ููุดุฑูุน ูุฒุงููุฉ ุงููุชุงุฌุฑ ุงููุชุนุฏุฏุฉ
# ูููู ูุฐุง ุงูุณูุฑูุจุช ุจุชุซุจูุช ุงูุชุจุนูุงุช ูุฅุนุฏุงุฏ ุงูุจูุฆุฉ ุงูุฃูููุฉ

echo "๐ ุจุฏุก ุฅุนุฏุงุฏ ูุดุฑูุน ูุฒุงููุฉ ุงููุชุงุฌุฑ ุงููุชุนุฏุฏุฉ..."

# ุงูุชุญูู ูู ุชุซุจูุช Node.js
if ! command -v node &> /dev/null; then
    echo "โ ูู ูุชู ุชุซุจูุช Node.js. ุงูุฑุฌุงุก ุชุซุจูุช Node.js (ุงูุฅุตุฏุงุฑ 14 ุฃู ุฃุนูู) ูููุชุงุจุนุฉ."
    exit 1
fi

# ุงูุชุญูู ูู ุฅุตุฏุงุฑ Node.js
NODE_VERSION=$(node -v | cut -d 'v' -f 2 | cut -d '.' -f 1)
if [ "$NODE_VERSION" -lt 14 ]; then
    echo "โ ูุทููุจ Node.js v14 ุฃู ุฃุนูู. ุงูุฅุตุฏุงุฑ ุงูุญุงูู: $(node -v)"
    exit 1
fi

echo "โ ุชู ุงููุดู ุนู Node.js $(node -v)"
echo "โ ุชู ุงููุดู ุนู NPM $(npm -v)"

# ุฅูุดุงุก ูููุงุช .env ุฅุฐุง ูู ุชูู ููุฌูุฏุฉ
if [ ! -f "./server/.env" ]; then
    echo "๐ ุฅูุดุงุก ููู .env ููุฎุงุฏู..."
    cp ./server/.env.example ./server/.env || echo "PORT=5000
MONGODB_URI=mongodb://localhost:27017/multi-store-sync
JWT_SECRET=ููุชุงุญ_ุณุฑู_ุขูู_ููุชุดููุฑ
JWT_EXPIRE=7d

# ููุงุชูุญ API ูุดูุจููุงู
SHOPIFY_API_KEY=ููุชุงุญ_API_ุดูุจููุงู
SHOPIFY_API_SECRET=ุงูุณุฑ_API_ุดูุจููุงู

# ููุงุชูุญ API ููุงุฒุงุฏุง
LAZADA_API_KEY=ููุชุงุญ_API_ูุงุฒุงุฏุง
LAZADA_API_SECRET=ุงูุณุฑ_API_ูุงุฒุงุฏุง

# ููุงุชูุญ API ูุดูุจู
SHOPEE_API_KEY=ููุชุงุญ_API_ุดูุจู
SHOPEE_API_SECRET=ุงูุณุฑ_API_ุดูุจู

# ููุงุชูุญ API ููููููุฑุณ
WOOCOMMERCE_API_KEY=ููุชุงุญ_API_ูููููุฑุณ
WOOCOMMERCE_API_SECRET=ุงูุณุฑ_API_ูููููุฑุณ" > ./server/.env
    
    echo "โ ุชู ุฅูุดุงุก ููู .env ููุฎุงุฏู"
    echo "โ๏ธ ุงูุฑุฌุงุก ุชุนุฏูู ููู ./server/.env ุจููุงุชูุญ API ูุงูุฅุนุฏุงุฏุงุช ุงูุฎุงุตุฉ ุจู"
fi

# ุชุซุจูุช ุชุจุนูุงุช ุงูุฎุงุฏู
echo "๐ฆ ุชุซุจูุช ุชุจุนูุงุช ุงูุฎุงุฏู..."
cd ./server && npm install
if [ $? -ne 0 ]; then
    echo "โ ุฎุทุฃ ูู ุชุซุจูุช ุชุจุนูุงุช ุงูุฎุงุฏู"
    exit 1
fi
echo "โ ุชู ุชุซุจูุช ุชุจุนูุงุช ุงูุฎุงุฏู ุจูุฌุงุญ"

# ุชุซุจูุช ุชุจุนูุงุช ุงูุนููู
echo "๐ฆ ุชุซุจูุช ุชุจุนูุงุช ุงูุนููู..."
cd ../client && npm install
if [ $? -ne 0 ]; then
    echo "โ ุฎุทุฃ ูู ุชุซุจูุช ุชุจุนูุงุช ุงูุนููู"
    exit 1
fi
echo "โ ุชู ุชุซุจูุช ุชุจุนูุงุช ุงูุนููู ุจูุฌุงุญ"

# ุงูุนูุฏุฉ ุฅูู ุงููุฌูุฏ ุงูุฑุฆูุณู
cd ..

# ุณุคุงู ุงููุณุชุฎุฏู ูุง ุฅุฐุง ูุงู ูุฑุบุจ ูู ุฒุฑุงุนุฉ ุจูุงูุงุช ุนููุฉ
read -p "ูู ุชุฑุบุจ ูู ุฒุฑุงุนุฉ ุจูุงูุงุช ุนููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุชุ (ู/ู): " SEED_DB
if [[ $SEED_DB =~ ^[ูYy]$ ]]; then
    echo "๐ฑ ุฒุฑุงุนุฉ ุจูุงูุงุช ุนููุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช..."
    node ./database/seeds/users.js
    node ./database/seeds/stores.js
    node ./database/seeds/products.js
    echo "โ ุชู ุฒุฑุงุนุฉ ุจูุงูุงุช ุงูุนููุฉ ุจูุฌุงุญ"
fi

echo "
๐ ุชู ุงูุฅุนุฏุงุฏ ุจูุฌุงุญ!

ูุจุฏุก ุงูุฎุงุฏู ูู ูุถุน ุงูุชุทููุฑ:
  cd server && npm run dev

ูุจุฏุก ุงูุนููู ูู ูุถุน ุงูุชุทููุฑ:
  cd client && npm start

ุณูููู ุงูุชุทุจูู ูุชุงุญูุง ุนูู:
  ุงูุนููู: http://localhost:3000
  ูุงุฌูุฉ API: http://localhost:5000

ููููู ุชุณุฌูู ุงูุฏุฎูู ุจุงุณุชุฎุฏุงู ุจูุงูุงุช ุงูุงุนุชูุงุฏ ุงูุชุงููุฉ (ุฅุฐุง ููุช ุจุฒุฑุงุนุฉ ุจูุงูุงุช ุงูุนููุฉ):
  ุงููุณุคูู: admin@example.com / admin123
  ุงููุณุชุฎุฏู: user@example.com / user123

ุดูุฑูุง ูุงุณุชุฎุฏุงู ูุธุงู ูุฒุงููุฉ ุงููุชุงุฌุฑ ุงููุชุนุฏุฏุฉ!
"